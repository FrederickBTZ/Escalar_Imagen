<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Escalar Imagen Ultra</title>
  <meta name="theme-color" content="#2E7D32">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon.ico">
  <style>
#image-upscaler { background:#ffffff; box-shadow:0 0 10px rgba(0,0,0,0.1); }
    body {
      background-color: #f1f8e9;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
  </style>
</head>

<body>
<div id="image-upscaler" style="font-family:Arial,sans-serif; max-width:400px; padding:20px; border:2px solid #4CAF50; border-radius:10px;">

  <h3 style="color:#2E7D32;">✨️Escalar Imagen Ultra</h3>
   <p style="color:#2E7D32; font-size:14px; line-height:1.4;">

    Esta herramienta permite aumentar la resolución y detalles de cualquier imagen de forma rápida y segura, directamente en tu navegador. 

    No utiliza Inteligencia Artificial, por lo que tus imágenes permanecen privadas y totalmente bajo tu control.  

    Gracias a un algoritmo de interpolación bicúbica profesional, la imagen conserva sus colores, brillo y apariencia original, mientras se generan más píxeles y detalles al escalarla.  

    Puedes elegir niveles de escalado desde x1 hasta x8, logrando una mejora notable de la calidad sin pérdida de información visual.  

    Todo el proceso se realiza localmente en tu dispositivo, evitando envíos a servidores externos y garantizando máxima seguridad y privacidad..

  </p>
  <input type="file" id="inputImage" accept="image/*" style="margin-bottom:10px;"/>

  

  <label for="scaleLevel" style="display:block; margin-bottom:5px; color:#2E7D32;">Nivel de Escalado:</label>

  <select id="scaleLevel" style="margin-bottom:10px; padding:5px;">

    <option value="1">x1</option>

    <option value="2">x2</option>

    <option value="3">x3</option>

    <option value="4">x4</option>

    <option value="5">x5</option>

    <option value="6">x6</option>

    <option value="7">x7</option>

    <option value="8">x8</option>

  </select>

  

  <button id="processButton" style="background-color:#66BB6A; color:white; border:none; padding:10px; border-radius:5px; cursor:pointer;">Escalar Imagen</button>

  

  <div id="progressContainer" style="margin-top:15px; display:none;">

    <div style="width:100%; background:#C8E6C9; border-radius:5px; overflow:hidden;">

      <div id="progressBar" style="width:0%; height:15px; background:#2E7D32;"></div>

    </div>

    <span id="progressText" style="font-size:12px; color:#2E7D32;">0%</span>

  </div>

  

  <div id="previewContainer" style="margin-top:20px; text-align:center;">

    <img id="previewImage" src="" style="max-width:100%; display:none; border:1px solid #4CAF50; border-radius:5px;"/>

    <br/>

    <a id="downloadBtn" href="#" download="" style="display:none; margin-top:10px; padding:8px 15px; background-color:#2E7D32; color:white; border-radius:5px; text-decoration:none;">Descargar</a>

  </div>

</div>

<script>

const input = document.getElementById('inputImage');

const preview = document.getElementById('previewImage');

const downloadBtn = document.getElementById('downloadBtn');

const button = document.getElementById('processButton');

const scaleSelect = document.getElementById('scaleLevel');

const progressContainer = document.getElementById('progressContainer');

const progressBar = document.getElementById('progressBar');

const progressText = document.getElementById('progressText');

let originalImage = null;

// Cargar imagen

input.addEventListener('change', (e) => {

  const file = e.target.files[0];

  if(!file) return;

  const reader = new FileReader();

  reader.onload = () => {

    originalImage = new Image();

    originalImage.src = reader.result;

    originalImage.onload = () => {

      preview.src = originalImage.src;

      preview.style.display = 'block';

      downloadBtn.style.display = 'none';

    }

  }

  reader.readAsDataURL(file);

});

// Función de interpolación bicúbica

function cubicInterpolate(v0,v1,v2,v3,x){

  return v1 + 0.5*x*(v2-v0 + x*(2.0*v0 - 5.0*v1 + 4.0*v2 - v3 + x*(3.0*(v1-v2)+v3-v0)));

}

function bicubicInterpolate(p, x, y){

  const arr = [];

  for(let i=0;i<4;i++){

    arr[i] = cubicInterpolate(p[i][0],p[i][1],p[i][2],p[i][3],x);

  }

  return cubicInterpolate(arr[0],arr[1],arr[2],arr[3],y);

}

// Escalado bicúbico profesional

async function upscaleBicubic(img, scale, progressCallback){

  const w = img.width;

  const h = img.height;

  const canvas = document.createElement('canvas');

  const ctx = canvas.getContext('2d');

  canvas.width = w * scale;

  canvas.height = h * scale;

  ctx.drawImage(img, 0, 0);

  const origData = ctx.getImageData(0,0,w,h);

  const origPixels = origData.data;

  const newData = ctx.createImageData(canvas.width, canvas.height);

  const newPixels = newData.data;

  for(let j=0;j<canvas.height;j++){

    const y = j/(canvas.height-1)*(h-1);

    const yInt = Math.floor(y);

    const yFrac = y - yInt;

    for(let i=0;i<canvas.width;i++){

      const x = i/(canvas.width-1)*(w-1);

      const xInt = Math.floor(x);

      const xFrac = x - xInt;

      for(let c=0;c<4;c++){

        const p = [];

        for(let m=-1;m<=2;m++){

          const row = [];

          let yy = Math.min(h-1,Math.max(0,yInt+m));

          for(let n=-1;n<=2;n++){

            let xx = Math.min(w-1,Math.max(0,xInt+n));

            row.push(origPixels[(yy*w+xx)*4+c]);

          }

          p.push(row);

        }

        newPixels[(j*canvas.width+i)*4+c] = Math.min(255,Math.max(0, bicubicInterpolate(p,xFrac,yFrac)));

      }

    }

    if(progressCallback && j%10===0) progressCallback(j/canvas.height);

    await new Promise(r=>setTimeout(r,0)); // evita bloqueo UI

  }

  ctx.putImageData(newData,0,0);

  return canvas;

}

// Botón escalar imagen

button.addEventListener('click', async () => {

  if(!originalImage) { alert("Por favor, selecciona una imagen."); return; }

  const scale = parseInt(scaleSelect.value);

  progressContainer.style.display = 'block';

  progressBar.style.width = '0%';

  progressText.innerText = '0%';

  const finalCanvas = await upscaleBicubic(originalImage, scale, (p)=>{

    const percent = Math.floor(p*100);

    progressBar.style.width = percent + '%';

    progressText.innerText = percent + '%';

  });

  const finalDataURL = finalCanvas.toDataURL('image/png');

  preview.src = finalDataURL;

  downloadBtn.href = finalDataURL;

  const now = new Date();

  const filename = `imagen_escalada_${now.getFullYear()}${now.getMonth()+1}${now.getDate()}_${now.getHours()}${now.getMinutes()}${now.getSeconds()}.png`;

  downloadBtn.download = filename;

  downloadBtn.style.display = 'inline-block';

  progressBar.style.width = '100%';

  progressText.innerText = 'Completado';

});

</script>
</body>
</html>

